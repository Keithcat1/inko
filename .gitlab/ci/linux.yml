---
test:compiler:linux:
  image: registry.gitlab.com/inko-lang/development-docker-images:alpine
  stage: test
  before_script:
    - ruby --version
    - gem --version
    - bundle --version
    - cd compiler
    - bundle config set path vendor
    - bundle install --retry=3
    - cd ..
  script:
    - make compiler/test
  cache:
    key: linux-compiler
    paths:
      - compiler/vendor/ruby

test:ivm:linux:
  image: registry.gitlab.com/inko-lang/development-docker-images:alpine
  stage: test
  before_script:
    - rustc --version
    - cargo --version
  script:
    - make vm/test
  cache:
    key: linux-vm
    paths:
      - .cargo
      - vm/target

test:runtime:linux:
  image: registry.gitlab.com/inko-lang/development-docker-images:alpine
  stage: test-runtime
  before_script:
    - ruby --version
    - rustc --version
    - cargo --version
  script:
    - make runtime/test
  cache:
    key: linux-vm
    paths:
      - .cargo
      - vm/target
  needs:
    - test:compiler:linux
    - test:ivm:linux
